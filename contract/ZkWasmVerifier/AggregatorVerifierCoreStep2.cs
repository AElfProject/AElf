using Bn254.Net;

namespace ZkWasmVerifier;

public class AggregatorVerifierCoreStep2 : IAggregatorVerifierCoreStep
{
    public UInt256[] VerifyProof(UInt256[] transcript, UInt256[] aux, UInt256[] buf)
    {
        // @formatter:off
        var mulmod = (UInt256 a, UInt256 b, UInt256 m) => (a * b) % m;
        var addmod = (UInt256 a, UInt256 b, UInt256 m) => (a + b) % m;
        buf[39] = mulmod(addmod(mulmod(mulmod(transcript[91], addmod(transcript[92], buf[3], AggregatorLib.q_mod), AggregatorLib.q_mod), addmod(transcript[94], buf[4], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod - buf[39], AggregatorLib.q_mod), buf[38], AggregatorLib.q_mod);
        buf[40] = addmod(transcript[92], AggregatorLib.q_mod - transcript[94], AggregatorLib.q_mod);
        buf[31] = mulmod(addmod(mulmod(addmod(mulmod(buf[31], buf[5], AggregatorLib.q_mod), buf[39], AggregatorLib.q_mod), buf[5], AggregatorLib.q_mod), mulmod(buf[37], buf[40], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[5], AggregatorLib.q_mod);
        buf[31] = mulmod(addmod(buf[31], mulmod(mulmod(buf[40], addmod(transcript[92], AggregatorLib.q_mod - transcript[93], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[38], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[5], AggregatorLib.q_mod);
        buf[31] = addmod(mulmod(addmod(buf[31], mulmod(buf[37], addmod(1, AggregatorLib.q_mod - transcript[95], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod), buf[5], AggregatorLib.q_mod), mulmod(buf[33], addmod(mulmod(transcript[95], transcript[95], AggregatorLib.q_mod), AggregatorLib.q_mod - transcript[95], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[33] = mulmod(mulmod(transcript[95], addmod(addmod(mulmod(18, buf[2], AggregatorLib.q_mod), transcript[53], AggregatorLib.q_mod), buf[3], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[34], AggregatorLib.q_mod);
        buf[33] = mulmod(addmod(mulmod(mulmod(transcript[96], addmod(transcript[97], buf[3], AggregatorLib.q_mod), AggregatorLib.q_mod), addmod(transcript[99], buf[4], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod - buf[33], AggregatorLib.q_mod), buf[38], AggregatorLib.q_mod);
        buf[34] = addmod(transcript[97], AggregatorLib.q_mod - transcript[99], AggregatorLib.q_mod);
        buf[31] = mulmod(addmod(mulmod(addmod(mulmod(buf[31], buf[5], AggregatorLib.q_mod), buf[33], AggregatorLib.q_mod), buf[5], AggregatorLib.q_mod), mulmod(buf[37], buf[34], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[5], AggregatorLib.q_mod);
        buf[31] = AggregatorLib.FrDiv(addmod(buf[31], mulmod(mulmod(buf[34], addmod(transcript[97], AggregatorLib.q_mod - transcript[98], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[38], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[36], aux[16]);
        buf[20] = mulmod(buf[17], buf[20], AggregatorLib.q_mod);
        buf[33] = mulmod(mulmod(mulmod(buf[20], buf[22], AggregatorLib.q_mod), buf[25], AggregatorLib.q_mod), buf[27], AggregatorLib.q_mod);
        buf[18] = addmod(mulmod(buf[8], addmod(mulmod(buf[8], buf[18], AggregatorLib.q_mod), mulmod(buf[21], buf[28], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod), mulmod(addmod(mulmod(buf[7], addmod(buf[29], buf[31], AggregatorLib.q_mod), AggregatorLib.q_mod), transcript[71], AggregatorLib.q_mod), buf[33], AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[21] = AggregatorLib.q_mod - buf[30];
        buf[29] = AggregatorLib.q_mod - buf[32];
        buf[30] = mulmod(buf[7], addmod(mulmod(addmod(mulmod(buf[23], transcript[49], AggregatorLib.q_mod), mulmod(buf[26], transcript[50], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[9], AggregatorLib.q_mod), addmod(mulmod(buf[21], transcript[49], AggregatorLib.q_mod), mulmod(buf[29], transcript[50], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[30] = addmod(buf[30], addmod(mulmod(addmod(mulmod(buf[23], transcript[88], AggregatorLib.q_mod), mulmod(buf[26], transcript[89], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[9], AggregatorLib.q_mod), addmod(mulmod(buf[21], transcript[88], AggregatorLib.q_mod), mulmod(buf[29], transcript[89], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[30] = addmod(mulmod(buf[7], buf[30], AggregatorLib.q_mod), addmod(mulmod(addmod(mulmod(buf[23], transcript[90], AggregatorLib.q_mod), mulmod(buf[26], transcript[91], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[9], AggregatorLib.q_mod), addmod(mulmod(buf[21], transcript[90], AggregatorLib.q_mod), mulmod(buf[29], transcript[91], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[30] = addmod(mulmod(buf[7], buf[30], AggregatorLib.q_mod), addmod(mulmod(addmod(mulmod(buf[23], transcript[95], AggregatorLib.q_mod), mulmod(buf[26], transcript[96], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[9], AggregatorLib.q_mod), addmod(mulmod(buf[21], transcript[95], AggregatorLib.q_mod), mulmod(buf[29], transcript[96], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[25] = mulmod(mulmod(buf[20], buf[25], AggregatorLib.q_mod), buf[27], AggregatorLib.q_mod);
        buf[31] = AggregatorLib.FrDiv(1, addmod(buf[6], AggregatorLib.q_mod - buf[24], AggregatorLib.q_mod), aux[17]);
        buf[32] = mulmod(buf[23], buf[31], AggregatorLib.q_mod);
        buf[34] = AggregatorLib.FrDiv(1, addmod(buf[19], AggregatorLib.q_mod - buf[24], AggregatorLib.q_mod), aux[18]);
        buf[36] = mulmod(buf[26], buf[34], AggregatorLib.q_mod);
        buf[37] = AggregatorLib.FrDiv(1, addmod(buf[24], AggregatorLib.q_mod - buf[6], AggregatorLib.q_mod), aux[19]);
        buf[38] = AggregatorLib.FrDiv(1, addmod(buf[24], AggregatorLib.q_mod - buf[19], AggregatorLib.q_mod), aux[20]);
        buf[39] = mulmod(buf[37], buf[38], AggregatorLib.q_mod);
        buf[40] = mulmod(buf[31], buf[24], AggregatorLib.q_mod);
        buf[23] = addmod(mulmod(buf[21], buf[31], AggregatorLib.q_mod), AggregatorLib.q_mod - mulmod(buf[23], buf[40], AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[24] = mulmod(buf[34], buf[24], AggregatorLib.q_mod);
        buf[26] = addmod(mulmod(buf[29], buf[34], AggregatorLib.q_mod), AggregatorLib.q_mod - mulmod(buf[26], buf[24], AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[31] = AggregatorLib.q_mod - mulmod(buf[37], buf[6], AggregatorLib.q_mod);
        buf[19] = mulmod(buf[38], buf[19], AggregatorLib.q_mod);
        buf[34] = addmod(mulmod(buf[31], buf[38], AggregatorLib.q_mod), AggregatorLib.q_mod - mulmod(buf[37], buf[19], AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[37] = addmod(mulmod(addmod(addmod(mulmod(buf[32], transcript[52], AggregatorLib.q_mod), mulmod(buf[36], transcript[55], AggregatorLib.q_mod), AggregatorLib.q_mod), mulmod(buf[39], transcript[57], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[9], AggregatorLib.q_mod), addmod(addmod(mulmod(buf[23], transcript[52], AggregatorLib.q_mod), mulmod(buf[26], transcript[55], AggregatorLib.q_mod), AggregatorLib.q_mod), mulmod(buf[34], transcript[57], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[21] = AggregatorLib.q_mod - mulmod(buf[21], buf[40], AggregatorLib.q_mod);
        buf[24] = AggregatorLib.q_mod - mulmod(buf[29], buf[24], AggregatorLib.q_mod);
        buf[19] = AggregatorLib.q_mod - mulmod(buf[31], buf[19], AggregatorLib.q_mod);
        buf[29] = mulmod(buf[7], addmod(mulmod(buf[37], buf[9], AggregatorLib.q_mod), addmod(addmod(mulmod(buf[21], transcript[52], AggregatorLib.q_mod), mulmod(buf[24], transcript[55], AggregatorLib.q_mod), AggregatorLib.q_mod), mulmod(buf[19], transcript[57], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[23] = addmod(mulmod(addmod(addmod(mulmod(buf[32], transcript[53], AggregatorLib.q_mod), mulmod(buf[36], transcript[54], AggregatorLib.q_mod), AggregatorLib.q_mod), mulmod(buf[39], transcript[56], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[9], AggregatorLib.q_mod), addmod(addmod(mulmod(buf[23], transcript[53], AggregatorLib.q_mod), mulmod(buf[26], transcript[54], AggregatorLib.q_mod), AggregatorLib.q_mod), mulmod(buf[34], transcript[56], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[19] = addmod(buf[29], addmod(mulmod(buf[23], buf[9], AggregatorLib.q_mod), addmod(addmod(mulmod(buf[21], transcript[53], AggregatorLib.q_mod), mulmod(buf[24], transcript[54], AggregatorLib.q_mod), AggregatorLib.q_mod), mulmod(buf[19], transcript[56], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod);
        buf[20] = mulmod(buf[20], buf[27], AggregatorLib.q_mod);
        buf[18] = addmod(mulmod(buf[8], addmod(mulmod(buf[8], buf[18], AggregatorLib.q_mod), mulmod(buf[30], buf[25], AggregatorLib.q_mod), AggregatorLib.q_mod), AggregatorLib.q_mod), mulmod(buf[19], buf[20], AggregatorLib.q_mod), AggregatorLib.q_mod);
        (buf[12], buf[13]) = (1, "21888242871839275222246405745257275088696311157297823662689037894645226208581");
        buf[14] = buf[18];
        AggregatorLib.EccMul(buf, 12);
        buf[19] = mulmod(buf[8], buf[8], AggregatorLib.q_mod);
        buf[21] = mulmod(buf[19], buf[33], AggregatorLib.q_mod);
        buf[23] = mulmod(buf[7], buf[7], AggregatorLib.q_mod);
        buf[24] = mulmod(buf[23], buf[23], AggregatorLib.q_mod);
        buf[26] = mulmod(buf[24], buf[24], AggregatorLib.q_mod);
        buf[27] = mulmod(buf[26], buf[26], AggregatorLib.q_mod);
        buf[29] = mulmod(buf[27], buf[26], AggregatorLib.q_mod);
        buf[30] = mulmod(buf[29], buf[24], AggregatorLib.q_mod);
        (buf[14], buf[15]) = (transcript[0], transcript[1]);
        buf[16] = mulmod(buf[21], buf[30], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        buf[31] = mulmod(buf[29], buf[23], AggregatorLib.q_mod);
        (buf[14], buf[15]) = (transcript[2], transcript[3]);
        buf[16] = mulmod(buf[21], mulmod(buf[31], buf[7], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = (transcript[4], transcript[5]);
        buf[16] = mulmod(buf[21], buf[31], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = (transcript[6], transcript[7]);
        buf[16] = mulmod(buf[21], mulmod(buf[29], buf[7], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        buf[25] = mulmod(buf[8], buf[25], AggregatorLib.q_mod);
        buf[31] = mulmod(buf[23], buf[7], AggregatorLib.q_mod);
        (buf[14], buf[15]) = (transcript[8], transcript[9]);
        buf[16] = mulmod(buf[25], buf[31], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = (transcript[10], transcript[11]);
        buf[16] = mulmod(buf[21], buf[29], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = (transcript[12], transcript[13]);
        buf[16] = mulmod(buf[20], buf[7], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = (transcript[14], transcript[15]);
        buf[16] = buf[20];
        AggregatorLib.EccMulAdd(buf, 12);
        buf[20] = mulmod(buf[27], buf[23], AggregatorLib.q_mod);
        (buf[14], buf[15]) = ("1207916945929808976270526282053854023692542739230000272873644015185793296368", "333655719733869244917384316784707989805538463000414489296314654544293187643");
        buf[16] = mulmod(buf[21], mulmod(buf[20], buf[7], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = ("618231491944314346890471681224521967871683178752309602681515366098407374206", "1547106910999542710330303205205471910035673487471512416409330152033984213442");
        buf[16] = mulmod(buf[21], buf[20], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        buf[20] = mulmod(buf[26], buf[24], AggregatorLib.q_mod);
        (buf[14], buf[15]) = ("13752304032751265773388568368690952313346373847818030355565198504575163252857", "15699138031843585527795027222357271693964445904506796528039783746896944572576");
        buf[16] = mulmod(buf[21], buf[20], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        buf[29] = mulmod(buf[26], buf[23], AggregatorLib.q_mod);
        (buf[14], buf[15]) = ("2860348938008516295342440148193198092510420690025470368433071928276330127666", "13798530407527146344832081201325939484315000250653330040095163163962642066101");
        buf[16] = mulmod(buf[21], mulmod(buf[29], buf[7], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = ("14390479789872834578949877445376305228054722011348207550893776286663419046557", "7204047301065162098259616074187017654572163314399050595428908522796007253977");
        buf[16] = mulmod(buf[21], buf[29], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = ("1056833256995721181794313947859361700675613255846609013688782956441439749526", "17440597018953292249182049648101858573256400831921081203912808720604993487466");
        buf[16] = mulmod(buf[21], mulmod(buf[27], buf[7], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = ("19207819916323799140539471238781937247533258479342753136419754431371864139220", "16398977035358673033090553616272584516942365359189763094905189335216399893048");
        buf[16] = mulmod(buf[21], buf[27], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        buf[29] = mulmod(buf[20], buf[23], AggregatorLib.q_mod);
        (buf[14], buf[15]) = ("18727268301254709837695561754430743811087178758994984866708998369335881794533", "5771006186783366108295805589828141419604675726535405645756208294112833055471");
        buf[16] = mulmod(buf[21], mulmod(buf[29], buf[7], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = ("8138420147872156333568125149467446041279298081497883420825913745857062420523", "13762450858016313545220019976563322968787227888972373523931845640799616686811");
        buf[16] = mulmod(buf[21], buf[29], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = ("13185867370215857208233387398040674400951489463742865783616623073151330329078", "3425883033867904231216730370053158898252175086457454738743683903644612966450");
        buf[16] = mulmod(buf[21], mulmod(buf[20], buf[7], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        buf[20] = mulmod(buf[27], buf[24], AggregatorLib.q_mod);
        (buf[14], buf[15]) = ("5809572897051189800056996065867944735828542713732596853907077380342000849224", "5770846417600899713009281105485305066210413547630759524415184441167035618969");
        buf[16] = mulmod(buf[21], buf[20], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = ("6378528853177786953117877890334142316482148143584178844724641201426346328155", "5124809223360507647814097145822761234530657230711863107799398382998817945911");
        buf[16] = mulmod(buf[21], mulmod(buf[20], buf[7], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = ("4936480706874911535373942394288673968130019275904758918617335440689668378821", "11933485432519003463128255408773500258400241194032466008744285015256152846462");
        buf[16] = mulmod(buf[21], mulmod(buf[26], buf[7], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = (transcript[100], transcript[101]);
        buf[16] = AggregatorLib.q_mod - mulmod(mulmod(buf[17], addmod(buf[9], AggregatorLib.q_mod - buf[6], AggregatorLib.q_mod), AggregatorLib.q_mod), buf[22], AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);
        (buf[14], buf[15]) = (transcript[102], transcript[103]);
        buf[16] = buf[9];
        AggregatorLib.EccMulAdd(buf, 12);
        buf[17] = mulmod(buf[21], buf[7], AggregatorLib.q_mod);
        (buf[14], buf[15]) = (transcript[42], transcript[43]);
        buf[16] = mulmod(buf[17], mulmod(buf[35], buf[35], AggregatorLib.q_mod), AggregatorLib.q_mod);
        AggregatorLib.EccMulAdd(buf, 12);

        // @formatter:on
        return buf;
    }
}