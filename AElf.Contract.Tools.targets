<?xml version="1.0"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <ProtoBaseDir>$(SolutionDir)\protobuf</ProtoBaseDir>
    </PropertyGroup>

    <ItemGroup>
        <None Include="$(ProtoBaseDir)\aelf\*">
            <Link>Protobuf/Proto/aelf/*</Link>
        </None>
    </ItemGroup>

    <Target Name="Gen_proto" BeforeTargets="BeforeBuild">
        <Exec Condition="@(ContractInternal) != ''" Command="protoc --proto_path=$(SolutionDir)/protobuf --csharp_out=internal_access:$(ProjectDir)/Protobuf/Generated --csharp_opt=file_extension=.g.cs %(Identity)"/>
        <Exec Condition="!$([MSBuild]::IsOsPlatform(Windows)) And @(ContractBase) != ''" Command="$(SolutionDir)/scripts/generate_contract_base.sh %(Identity)"/>
        <Exec Condition="!$([MSBuild]::IsOsPlatform(Windows)) And @(ContractCode) != ''" Command="$(SolutionDir)/scripts/generate_contract_code.sh %(Identity)"/>
        <Exec Condition="!$([MSBuild]::IsOsPlatform(Windows)) And @(ContractReference) != ''" Command="$(SolutionDir)/scripts/generate_contract_reference.sh %(Identity)"/>
        <Exec Condition="!$([MSBuild]::IsOsPlatform(Windows)) And @(ContractStub) != ''" Command="$(SolutionDir)/scripts/generate_contract_stub.sh %(Identity)"/>
        <Exec Condition="$([MSBuild]::IsOsPlatform(Windows)) And @(ContractBase) != ''" Command="$(SolutionDir)\scripts\generate_contract_base.bat %(Identity)"/>
        <Exec Condition="$([MSBuild]::IsOsPlatform(Windows)) And @(ContractCode) != ''" Command="$(SolutionDir)\scripts\generate_contract_code.bat %(Identity)"/>
        <Exec Condition="$([MSBuild]::IsOsPlatform(Windows)) And @(ContractReference) != ''" Command="$(SolutionDir)\scripts\generate_contract_reference.bat %(Identity)"/>
        <Exec Condition="$([MSBuild]::IsOsPlatform(Windows)) And @(ContractStub) != ''" Command="$(SolutionDir)\scripts\generate_contract_stub.bat %(Identity)"/>
    </Target>
    <Target Name="UpdateGeneratedFiles" DependsOnTargets="Gen_proto" BeforeTargets="BeforeBuild">
        <ItemGroup>
            <Compile Include="./Protobuf/Generated/*.cs"/>
        </ItemGroup>
    </Target>
</Project>